<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>TODOç®¡ç† - æœ€å°é™ã‚¹ã‚¿ãƒ¼ãƒˆç‰ˆ</title>
    <style>
        body { font-family: system-ui; max-width: 600px; margin: 0 auto; padding: 20px; }
        .chat { border: 1px solid #ddd; height: 300px; overflow-y: auto; padding: 10px; margin: 10px 0; }
        .user { text-align: right; color: blue; margin: 5px 0; }
        .assistant { text-align: left; color: green; margin: 5px 0; }
        .tool { background: #f0f0f0; padding: 5px; margin: 5px 0; font-size: 0.9em; }
        input { width: 80%; padding: 10px; }
        button { padding: 10px 20px; }
        .todo { background: #fff3cd; border: 1px solid #ffeaa7; margin: 5px 0; padding: 10px; }
        .examples { margin: 10px 0; }
        .examples button { margin: 2px; padding: 5px 10px; font-size: 0.8em; }
    </style>
</head>
<body>
    <h1>ğŸ“ TODOç®¡ç† - æœ€å°é™ã‚¹ã‚¿ãƒ¼ãƒˆç‰ˆ</h1>
    <p><strong>è¨­è¨ˆæ€æƒ³:</strong> PowerShell(LLMå‡¦ç†) âŸ· JavaScript(GUIãƒ»ãƒ‡ãƒ¼ã‚¿ç®¡ç†)</p>
    
    <div class="examples">
        <button onclick="setInput('ä»Šåº¦ã®é€±æœ«ã€å‹é”ã¨æ˜ ç”»ã‚’è¦‹ã‚‹äºˆå®šãŒã‚ã‚‹ã‚“ã ã‘ã©ã€ä»–ã«ã‚‚ã‚„ã‚ŠãŸã„ã“ã¨ãŒã‚ã£ã¦æ•´ç†ã—ãŸã„')">é€±æœ«äºˆå®š</button>
        <button onclick="setInput('æ´—æ¿¯ã€è²·ã„ç‰©ã€èª­æ›¸ã‚‚ã—ãŸã„')">è¿½åŠ ã‚¿ã‚¹ã‚¯</button>
        <button onclick="showTodos()">ä¿å­˜æ¸ˆã¿è¡¨ç¤º</button>
    </div>
    
    <div id="chat" class="chat">
        <div class="assistant">ã“ã‚“ã«ã¡ã¯ï¼TODOã®æ•´ç†ã‚’ãŠæ‰‹ä¼ã„ã—ã¾ã™ ğŸ˜Š</div>
    </div>
    
    <input type="text" id="input" placeholder="ã‚„ã‚ŠãŸã„ã“ã¨ã‚’æ•™ãˆã¦ãã ã•ã„..." onkeypress="if(event.key==='Enter') send()">
    <button onclick="send()">é€ä¿¡</button>
    
    <div id="todos"></div>

    <script>
        // JavaScriptè²¬ä»»ç¯„å›²: GUIæ“ä½œã€ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
        let todos = JSON.parse(localStorage.getItem('todos') || '[]');
        let conversation = [];

        function setInput(text) {
            document.getElementById('input').value = text;
            document.getElementById('input').focus();
        }

        function addMessage(role, content, isToolCall = false) {
            const chat = document.getElementById('chat');
            const div = document.createElement('div');
            
            if (isToolCall) {
                div.className = 'tool';
                div.textContent = 'ğŸ”§ ' + content;
            } else {
                div.className = role;
                div.textContent = (role === 'user' ? 'ğŸ‘¤ ' : 'ğŸ¤– ') + content;
            }
            
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }

        async function send() {
            const input = document.getElementById('input');
            const message = input.value.trim();
            if (!message) return;

            addMessage('user', message);
            conversation.push({ role: 'user', content: message });
            input.value = '';

            try {
                // PowerShellã«LLMå‡¦ç†ã‚’ä¾é ¼
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ messages: conversation })
                });

                const data = await response.json();
                
                if (data.content && data.content[0]) {
                    const assistantMsg = data.content[0].text;
                    addMessage('assistant', assistantMsg);
                    conversation.push({ role: 'assistant', content: assistantMsg });
                }

                // ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ãŒã‚ã‚‹å ´åˆï¼ˆJavaScriptå´ã§ãƒ‡ãƒ¼ã‚¿ç®¡ç†ï¼‰
                if (data.tool_calls && data.tool_calls.length > 0) {
                    for (const toolCall of data.tool_calls) {
                        if (toolCall.function.name === 'todo_save') {
                            const args = JSON.parse(toolCall.function.arguments);
                            
                            // JavaScriptã§ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ï¼ˆJavaScriptè²¬ä»»ç¯„å›²ï¼‰
                            todos.push(args);
                            localStorage.setItem('todos', JSON.stringify(todos));
                            
                            addMessage('', `âœ… ${args.items.length}å€‹ã®ã‚¿ã‚¹ã‚¯ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼`, true);
                            showTodos();
                        }
                    }
                }
            } catch (error) {
                addMessage('assistant', 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            }
        }

        function showTodos() {
            const todosDiv = document.getElementById('todos');
            if (todos.length === 0) {
                todosDiv.innerHTML = '<p>ä¿å­˜ã•ã‚ŒãŸTODOã¯ã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }

            todosDiv.innerHTML = '<h3>ğŸ’¾ ä¿å­˜æ¸ˆã¿TODO:</h3>' + 
                todos.map((todo, index) => `
                    <div class="todo">
                        <strong>ğŸ“… ${todo.timestamp}</strong> | ğŸ“‚ ${todo.category} | â­ ${todo.priority}
                        <br>
                        ${todo.items.map(item => `â€¢ ${item}`).join('<br>')}
                        <br>
                        <small>ID: ${todo.id}</small>
                        <button onclick="deleteTodo(${index})" style="float: right;">ğŸ—‘ï¸</button>
                    </div>
                `).join('');
        }

        function deleteTodo(index) {
            todos.splice(index, 1);
            localStorage.setItem('todos', JSON.stringify(todos));
            showTodos();
        }

        // åˆæœŸåŒ–
        showTodos();
        document.getElementById('input').focus();
    </script>
</body>
</html>